<!doctype html>
<html class="no-js" lang="en" data-content_root="">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Search" href="search.html" /><link rel="next" title="Outputs" href="outputs.html" /><link rel="prev" title="Mapping" href="mapping.html" />

    <!-- Generated with Sphinx 7.1.2 and Furo 2024.08.06 -->
        <title>Stages - Stream 1.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?v=302659d7" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  --color-brand-primary: #2B6CB0;
  --color-brand-content: #1A202C;
  --color-admonition-title-background: #EBF8FF;
  --color-admonition-background: #FCF7F7;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --color-brand-primary: #63B3ED;
  --color-brand-content: #E2E8F0;
  --color-admonition-title-background: #2C5282;
  --color-admonition-background: #1A202C;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --color-brand-primary: #63B3ED;
  --color-brand-content: #E2E8F0;
  --color-admonition-title-background: #2C5282;
  --color-admonition-background: #1A202C;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">Stream 1.0.0 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo only-light" src="_static/stream_horizontal_logo_light.svg" alt="Light Logo"/>
    <img class="sidebar-logo only-dark" src="_static/stream_horizontal_logo_dark.svg" alt="Dark Logo"/>
  </div>
  
  <span class="sidebar-brand-text">Stream 1.0.0 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installing Stream</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting-started.html">Getting Started</a></li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="user-guide.html">User Guide</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of User Guide</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="workload.html">Workload</a></li>
<li class="toctree-l2"><a class="reference internal" href="hardware.html">Hardware Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="mapping.html">Mapping</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Stages</a></li>
<li class="toctree-l2"><a class="reference internal" href="outputs.html">Outputs</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="future.html">Future changes</a></li>
<li class="toctree-l1"><a class="reference internal" href="contribute.html">Contribute</a></li>
<li class="toctree-l1"><a class="reference internal" href="publications.html">Publications</a></li>
</ul>

</div>
      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="https://github.com/kuleuven-micas/stream/blob/master/docs/source/stages.rst?plain=true" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div><div class="edit-this-page">
  <a class="muted-link" href="https://github.com/kuleuven-micas/stream/edit/master/docs/source/stages.rst" title="Edit this page">
    <svg><use href="#svg-pencil"></use></svg>
    <span class="visually-hidden">Edit this page</span>
  </a>
</div><div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="stages">
<h1>Stages<a class="headerlink" href="#stages" title="Permalink to this heading">¶</a></h1>
<p>This document explains the concept of stages within the Stream framework. It details the different implemented stages and explains how to create your own.</p>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this heading">¶</a></h2>
<p>Stages within Stream are used to modularly and easily adapt the functionality of the framework. The different stages and their sequence of execution determine the goal of running the framework. The sequence of stages the framework will run through are defined in the main file. An example as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mainstage</span> <span class="o">=</span> <span class="n">MainStage</span><span class="p">(</span>
    <span class="p">[</span>  <span class="c1"># Initializes the MainStage as entry point</span>
        <span class="n">AcceleratorParserStage</span><span class="p">,</span>  <span class="c1"># Parses the accelerator</span>
        <span class="n">StreamONNXModelParserStage</span><span class="p">,</span>  <span class="c1"># Parses the ONNX Model into the workload</span>
        <span class="n">LayerSplittingStage</span><span class="p">,</span>  <span class="c1"># Split the workload</span>
        <span class="n">StreamONNXModelParserStage</span><span class="p">,</span>  <span class="c1"># Parses the potentially split ONNX model into the workload</span>
        <span class="n">GenerateCNWorkloadHybridStage</span><span class="p">,</span>  <span class="c1"># Generate fine-grained CN workload graph</span>
        <span class="n">IntraCoreMappingStage</span><span class="p">,</span>  <span class="c1"># Find the optimal CME for each valid layer-core assignment</span>
        <span class="n">InterCoreMappingStage</span><span class="p">,</span>  <span class="c1"># Find the optimal layer-core assignment for the entire workload</span>
    <span class="p">],</span>
    <span class="n">accelerator</span><span class="o">=</span><span class="n">accelerator</span><span class="p">,</span>  <span class="c1"># required by AcceleratorParserStage</span>
    <span class="n">workload_path</span><span class="o">=</span><span class="n">workload_path</span><span class="p">,</span>  <span class="c1"># required by ModelParserStage</span>
    <span class="n">mapping_path</span><span class="o">=</span><span class="n">mapping_path</span><span class="p">,</span>  <span class="c1"># required by ModelParserStage</span>
    <span class="n">loma_lpf_limit</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>  <span class="c1"># required by LomaEngine</span>
    <span class="n">nb_ga_individuals</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span>  <span class="c1"># number of individuals in each genetic algorithm generation</span>
    <span class="n">nb_ga_generations</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>  <span class="c1"># number of genetic algorithm generations</span>
    <span class="n">cost_lut_path</span><span class="o">=</span><span class="n">cost_lut_path</span><span class="p">,</span>  <span class="c1"># saved CostModelEvaluationLUT to skip re-computation</span>
    <span class="n">plot_hof</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># Save schedule and memory usage plot of each individual in the Genetic Algorithm hall of fame</span>
    <span class="n">plot_file_name</span><span class="o">=</span><span class="n">plot_file_name</span><span class="p">,</span>
    <span class="n">plot_full_schedule</span><span class="o">=</span><span class="n">plot_full_schedule</span><span class="p">,</span>
    <span class="n">plot_data_transfer</span><span class="o">=</span><span class="n">plot_data_transfer</span><span class="p">,</span>
    <span class="n">cn_define_mode</span><span class="o">=</span><span class="n">CN_define_mode</span><span class="p">,</span>
    <span class="n">hint_loops</span><span class="o">=</span><span class="n">hint_loops</span><span class="p">,</span>
    <span class="n">scheduler_candidate_selection</span><span class="o">=</span><span class="s2">&quot;memory&quot;</span><span class="p">,</span>
    <span class="n">operands_to_prefetch</span><span class="o">=</span><span class="p">[],</span>
    <span class="n">split_onnx_model_path</span><span class="o">=</span><span class="n">split_onnx_model_path</span><span class="p">,</span>
    <span class="n">split_W_double_buffered</span><span class="o">=</span><span class="n">split_W_double_buffered</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Launch the MainStage</span>
<span class="n">scme</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">mainstage</span><span class="o">.</span><span class="n">run</span><span class="p">()</span> <span class="c1"># Run the MainStage</span>
<span class="n">scme</span> <span class="o">=</span> <span class="n">scme</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># Select one of the returned cost models for later inspection</span>
</pre></div>
</div>
</section>
<section id="implemented-stages">
<h2>Implemented stages<a class="headerlink" href="#implemented-stages" title="Permalink to this heading">¶</a></h2>
<p>This section is still being updated. For a missing description, please look at the stages requirements in <a class="reference external" href="https://github.com/KULeuven-MICAS/stream/blob/master/stream/classes/stages/__init__.py">__init__.py</a> and the stage implementation in the <a class="reference external" href="https://github.com/KULeuven-MICAS/stream/tree/master/stream/classes/stages">stages</a> folder.</p>
<p id="custom-stages-label">The following stages are implemented in Stream:</p>
<section id="id2">
<h3><a class="reference external" href="https://github.com/KULeuven-MICAS/stream/blob/master/stream/classes/stages/CustomSpatialMappingGeneratorStage.py#L23">CustomSpatialMappingGeneratorStage</a><a class="headerlink" href="#id2" title="Permalink to this heading">¶</a></h3>
<p>Stage that finds spatial mappings given a accelerator, core allocation, interconnection pattern on the allocated core, layer. The spatial mappings are found using the interconnection pattern present on the core. The inner-most memory level served dimensions is used, as this is how the memories connect to the operational array.</p>
</section>
<section id="id3">
<h3><a class="reference external" href="https://github.com/KULeuven-MICAS/stream/blob/master/stream/classes/stages/GenerateCNWorkloadHybridStage.py#L29">GenerateCNWorkloadHybridStage</a><a class="headerlink" href="#id3" title="Permalink to this heading">¶</a></h3>
<p>Stage that transforms the layer-by-layer workload into finer CN workload graph.
Multiple modes are applicable through the <cite>cn_define_mode</cite> parameter in conjunction with the <cite>hint_loops</cite> parameter:</p>
<ol class="arabic simple">
<li><p><cite>hint_loops</cite> specifies the outer-cn loops based on which the layer will be split.</p></li>
<li><p><cite>hint_loops</cite> specifies the inner-cn loops. The outer-cn loops are all remaining loops.</p></li>
<li><p><cite>hint_loops</cite> specifies a nested list of loops. <cite>layer_cutoffs</cite> specifies until which layer index each list of outer-cn loops is applicable.</p></li>
<li><p><cite>hint_loops</cite> specifies the outer-cn loops. <cite>split_W_percentage</cite> specifies the maximal percentage the constant operands may occupy on the respective memories in the cores they can be allocated to. If multiple cores have a different constant operand memory capacity, the capacity is taken to be the smallest. If a layer has a larger footprint, it will be split in terms of output channels by appending the <cite>K</cite> loops to the <cite>hint_loops</cite>.</p></li>
</ol>
</section>
<section id="id4">
<h3><a class="reference external" href="https://github.com/KULeuven-MICAS/stream/blob/master/stream/classes/stages/InterCoreMappingStage.py#L17">InterCoreMappingStage</a><a class="headerlink" href="#id4" title="Permalink to this heading">¶</a></h3>
<p>Stage that finds the best inter-core mapping using a genetic algorithm. From the IntraCoreMappingStage we receive the <cite>CostModelEvaluationLUT</cite>, containing for each node and its valid core allocations the best CME. We then initialize the genetic algorithm.</p>
</section>
<section id="id5">
<h3><a class="reference external" href="https://github.com/KULeuven-MICAS/stream/blob/master/stream/classes/stages/IntraCoreMappingStage.py#L22/">IntraCoreMappingStage</a><a class="headerlink" href="#id5" title="Permalink to this heading">¶</a></h3>
<p>Stage that finds the optimal ZigZag CME for each valid node-core allocation. This is saved to a dictionary which is passed to the subsequent stages.
The <cite>loop_ranges</cite> attribute op each CN determines the unique nodes to be evaluated. If two nodes have a difference in <cite>loop_ranges</cite> in a dimension that is relevant for the constant operands of the node, e.g. the <cite>K</cite> loop in a traditoinal convolutional layer, the node is assigned to a different group which will be allocated separately in the <cite>InterCoreMappingStage</cite>.</p>
</section>
<section id="id6">
<h3><a class="reference external" href="https://github.com/KULeuven-MICAS/stream/blob/master/stream/classes/stages/ModelParserStage.py#L11">ONNXModelParserStage</a><a class="headerlink" href="#id6" title="Permalink to this heading">¶</a></h3>
<p>Stage that parses the input workload residing in accelerator_path. The “workload” dict is converted to a NetworkX graph.</p>
<p>Besides these stages, the <a class="reference external" href="https://kuleuven-micas.github.io/zigzag/stages.html#implemented-stages">implemented stages from the ZigZag framework</a> can be used as well.</p>
</section>
</section>
<section id="creating-your-custom-stage">
<h2>Creating your custom stage<a class="headerlink" href="#creating-your-custom-stage" title="Permalink to this heading">¶</a></h2>
<p>Let’s say you are not interested in saving the CME with minimal energy, but want to save based on another metric provided by the CME, or you want to define a new temporal mapping generator stage, you can easily create a custom stage. The easiest way is copying an existing stage class definition, and modifying it according to your intended behaviour. To guarantee correctness, following aspects have to be taken into account when creating a custom stage:</p>
<ul class="simple">
<li><p>It must inherit from the abstract <code class="docutils literal notranslate"><span class="pre">Stage</span></code> class.</p></li>
<li><p>It must create its <code class="docutils literal notranslate"><span class="pre">substage</span></code> as the first element of the list of callables, with the remaining list as its first argument, and <code class="docutils literal notranslate"><span class="pre">**kwargs</span></code> as the second argument. These kwargs can be updated to change e.g. the accelerator, spatial mapping, temporal mapping, etc.</p></li>
<li><p>It must iterate over the different <code class="docutils literal notranslate"><span class="pre">(CME,</span> <span class="pre">extra_info)</span></code> tuples yielded by the <code class="docutils literal notranslate"><span class="pre">substage.run()</span></code> call in a for loop.</p></li>
<li><p>If the stage is a reduction (like e.g. the <code class="docutils literal notranslate"><span class="pre">MinimalLatencyStage</span></code>), its <code class="docutils literal notranslate"><span class="pre">yield</span></code> statement must be outside the for loop which iterates over the returned <code class="docutils literal notranslate"><span class="pre">(CME,</span> <span class="pre">extra_info)</span></code> tuples, where some processing happens inside the for loop.</p></li>
</ul>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="outputs.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Outputs</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="mapping.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Mapping</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2023–2025, MICAS, KU Leuven
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Stages</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#implemented-stages">Implemented stages</a><ul>
<li><a class="reference internal" href="#id2">CustomSpatialMappingGeneratorStage</a></li>
<li><a class="reference internal" href="#id3">GenerateCNWorkloadHybridStage</a></li>
<li><a class="reference internal" href="#id4">InterCoreMappingStage</a></li>
<li><a class="reference internal" href="#id5">IntraCoreMappingStage</a></li>
<li><a class="reference internal" href="#id6">ONNXModelParserStage</a></li>
</ul>
</li>
<li><a class="reference internal" href="#creating-your-custom-stage">Creating your custom stage</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="./" id="documentation_options" src="_static/documentation_options.js?v=367f7090"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="_static/scripts/furo.js?v=5fa4622c"></script>
    </body>
</html>